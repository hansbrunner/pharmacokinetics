hej <-
hej <- 3
print(hej)
setwd("C:/Users/AdministratÃ¶r/Desktop/Klinisk Data Analyse/nibr")
pk_data <- read_csv('../data/Single_Ascending_Dose_Dataset2.csv')
library(ggplot2)
library(dplyr)
library(tidyr)
library(xgxr)
pk_data <- read_csv('../data/Single_Ascending_Dose_Dataset2.csv')
library(tidyr)
library(xgxr)
library(ggplot2)
library(dplyr)
pk_data <- read_csv('../data/Single_Ascending_Dose_Dataset2.csv')
install.packages(c("ggplot2", "dplyr", "tidyr", "xgxr"))
library(ggplot2)
library(dplyr)
library(tidyr)
library(xgxr)
pk_data <- read_csv('../data/Single_Ascending_Dose_Dataset2.csv')
library(readr)
pk_data <- read_csv('../data/Single_Ascending_Dose_Dataset2.csv')
library(readr)
Single_Ascending_Dose_Dataset2 <- read_csv("data/Single_Ascending_Dose_Dataset2.csv")
View(Single_Ascending_Dose_Dataset2)
pk_data <- read_csv('data/Single_Ascending_Dose_Dataset2.csv')
head(pk_data)
view(pk_data)
pkpd_data <- read_csv('data/Single_Ascending_Dose_Dataset2.csv')
head(pkpd_data)
pkpd_data = pkpd_data %>%
arrange(DOSE) %>%
mutate(TRTACT_low2high = factor(TRTACT, levels = unique(TRTACT)),
TRTACT_high2low = factor(TRTACT, levels = rev(unique(TRTACT)))) %>%
select(-TRTACT)
pk_data <- pkpd_data %>%
filter(CMT==2)
NCA = pk_data %>%
group_by(ID, DOSE) %>%
filter(!is.na(LIDV)) %>%
summarize(AUC_last = caTools::trapz(TIME,LIDV),
Cmax     = max(LIDV),
SEX      = SEX[1], #this part just keeps the SEX and WEIGHTB covariates
WEIGHTB  = WEIGHTB[1]) %>%
gather(PARAM, VALUE,-c(ID, DOSE, SEX, WEIGHTB)) %>%
ungroup() %>%
mutate(VALUE_NORM = VALUE/DOSE)
NCA
library(caTools)
install.packages("caTools")
NCA = pk_data %>%
group_by(ID, DOSE) %>%
filter(!is.na(LIDV)) %>%
summarize(AUC_last = caTools::trapz(TIME,LIDV),
Cmax     = max(LIDV),
SEX      = SEX[1], #this part just keeps the SEX and WEIGHTB covariates
WEIGHTB  = WEIGHTB[1]) %>%
gather(PARAM, VALUE,-c(ID, DOSE, SEX, WEIGHTB)) %>%
ungroup() %>%
mutate(VALUE_NORM = VALUE/DOSE)
View(NCA)
View(pk_data)
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot <- ct_plot + xgx_stat_ci(conf_level = .95)
ct_plot <- ct_plot + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
time_units_dataset = "hours"
time_units_plot    = "days"
trtact_label       = "Dose"
dose_label         = "Dose (mg)"
conc_units         = "ng/ml"
AUC_units          = paste0("h.", conc_units)
conc_label         = paste0("Concentration (", conc_units, ")")
concnorm_label     = paste0("Normalized Concentration (", conc_units, ")/mg")
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot <- ct_plot + xgx_stat_ci(conf_level = .95)
ct_plot <- ct_plot + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot <- ct_plot + labs(y=conc_label,color = trtact_label)
print(ct_plot)
ct_plot <- ct_plot + xgx_annotate_status(status)
# Concentration time plot for all doses
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot <- ct_plot + xgx_stat_ci(conf_level = .95)
ct_plot <- ct_plot + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot <- ct_plot + labs(y=conc_label,color = trtact_label)
print(ct_plot)
ct_plot_log_y <- ct_plot + xgx_scale_y_log10()
print(ct_plot)
ct_plot_log_y <- ct_plot + xgx_scale_y_log10()
print(ct_plot_log_y)
# used LIDV_NORM instead of LIDV
ct_plot_norm <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV_NORM,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot_norm <- ct_plot_norm + xgx_stat_ci(conf_level = 0.95, alpha = 0.5, position = position_dodge(1))
ct_plot_norm <- ct_plot_norm + xgx_scale_y_log10()
ct_plot_norm <- ct_plot_norm + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot_norm <- ct_plot_norm + labs(y=concnorm_label, color = trtact_label)
print(ct_plot_norm)
pk_data <- pk_data %>%
mutate(LIDV_NORM = LIDV/DOSE)
ct_plot_norm <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV_NORM,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot_norm <- ct_plot_norm + xgx_stat_ci(conf_level = 0.95, alpha = 0.5, position = position_dodge(1))
ct_plot_norm <- ct_plot_norm + xgx_scale_y_log10()
ct_plot_norm <- ct_plot_norm + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot_norm <- ct_plot_norm + labs(y=concnorm_label, color = trtact_label)
print(ct_plot_norm)
knitr::opts_chunk$set(echo = TRUE)
library(readr)
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot <- ct_plot + xgx_stat_ci(conf_level = .95)
ct_plot <- ct_plot + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot <- ct_plot + labs(y=conc_label,color = trtact_label)
print(ct_plot)
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot <- ct_plot + xgx_stat_ci(conf_level = .95)
ct_plot <- ct_plot + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot <- ct_plot + labs(y=conc_label,color = trtact_label)
# Make semilog plot
ct_plot_log <- ct_plot +
scale_y_log10() +
labs(y = paste0(conc_label, " (Log Scale)"))
combined_plot <- ct_plot + ct_plot_log + plot_layout(ncol = 2)
print(combined_plot)
install.packages("patchwork")
library(patchwork)
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot <- ct_plot + xgx_stat_ci(conf_level = .95)
ct_plot <- ct_plot + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot <- ct_plot + labs(y=conc_label,color = trtact_label)
# Make semilog plot
ct_plot_log <- ct_plot +
scale_y_log10() +
labs(y = paste0(conc_label, " (Log Scale)"))
combined_plot <- ct_plot + ct_plot_log + plot_layout(ncol = 2)
print(combined_plot)
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot <- ct_plot + xgx_stat_ci(conf_level = .95)
ct_plot <- ct_plot + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot <- ct_plot + labs(y=conc_label,color = trtact_label)
# Make semilog plot
ct_plot_log <- ct_plot +
scale_y_log10() +
theme(legend.position = "none") +
labs(y = paste0(conc_label, " (Log Scale)"))
combined_plot <- ct_plot + ct_plot_log + plot_layout(ncol = 2)
print(combined_plot)
pk_data <- pk_data %>%
mutate(LIDV_NORM = LIDV/DOSE)
ct_plot_norm <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV_NORM,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot_norm <- ct_plot_norm + xgx_stat_ci(conf_level = 0.95, alpha = 0.5, position = position_dodge(1))
ct_plot_norm <- ct_plot_norm + xgx_scale_y_log10()
ct_plot_norm <- ct_plot_norm + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot_norm <- ct_plot_norm + labs(y=concnorm_label, color = trtact_label)
print(ct_plot_norm)
pk_data <- pk_data %>%
mutate(LIDV_NORM = LIDV/DOSE)
ct_plot_norm <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV_NORM,
group = TRTACT_high2low,
color = TRTACT_high2low))
ct_plot_norm <- ct_plot_norm + xgx_stat_ci(conf_level = 0.95, alpha = 0.5, position = position_dodge(1))
ct_plot_norm <- ct_plot_norm + xgx_scale_y_log10()
ct_plot_norm <- ct_plot_norm + xgx_scale_x_time_units(units_dataset = time_units_dataset,
units_plot    = time_units_plot)
ct_plot_norm <- ct_plot_norm + labs(y=concnorm_label, color = trtact_label)
# Make semilog plot
ct_plot_log <- ct_plot_norm +
scale_y_log10() +
theme(legend.position = "none") +
labs(y = paste0(conc_label, " (Log Scale)"))
combined_plot <- ct_plot_norm + ct_plot_log + plot_layout(ncol = 2)
print(combined_plot)
print(ct_plot_norm)
head(NCA)
gg <- ggplot(data = NCA, aes(x = DOSE, y = VALUE_NORM))
gg <- gg + geom_boxplot(aes(group = DOSE))
gg <- gg + geom_smooth(method = "lm", color = "black")
gg <- gg + facet_wrap(~PARAM, scales = "free_y")
gg <- gg + labs(x = dose_label, y = concnorm_label)
gg <- gg + xgx_annotate_status(status)
gg <- gg + xgx_annotate_filenames(dirs)
#if saving copy of figure, replace xgx_annotate lines with xgx_save() shown below:
#xgx_save(width,height,dirs,"filename_main",status)
print(gg)
gg <- ggplot(data = NCA, aes(x = DOSE, y = VALUE_NORM))
gg <- gg + geom_boxplot(aes(group = DOSE))
gg <- gg + geom_smooth(method = "lm", color = "black")
gg <- gg + facet_wrap(~PARAM, scales = "free_y")
gg <- gg + labs(x = dose_label, y = concnorm_label)
print(gg)
View(NCA)
auc_data <- NCA %>% filter(PARAM == "AUC_last")
cmax_data <- NCA %>% filter(PARAM == "Cmax")
# AUC Men vs Women
boxplot_auc <- ggplot(auc_data, aes(x = SEX, y = VALUE_NORM, fill = SEX)) +
geom_boxplot() +
labs(title = "Dose-normalized AUC by Sex", y = "AUC_norm", x = "Sex") +
theme_minimal()
# Cmax Men vs Women
boxplot_cmax <- ggplot(cmax_data, aes(x = SEX, y = VALUE_NORM, fill = SEX)) +
geom_boxplot() +
labs(title = "Dose-normalized Cmax by Sex", y = "Cmax_norm", x = "Sex") +
theme_minimal()
# AUC vs bodyweight
scatter_auc <- ggplot(auc_data, aes(x = WEIGHTB, y = VALUE_NORM, color = SEX)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "AUC_norm vs Body Weight", x = "Body Weight", y = "AUC_norm") +
theme_minimal()
# Cmax vs bodyweigh
scatter_cmax <- ggplot(cmax_data, aes(x = WEIGHTB, y = VALUE_NORM, color = SEX)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "Cmax_norm vs Body Weight", x = "Body Weight", y = "Cmax_norm") +
theme_minimal()
combined_plot <- (boxplot_auc | boxplot_cmax) / (scatter_auc | scatter_cmax)
print(combined_plot)
auc_data <- NCA %>% filter(PARAM == "AUC_last")
cmax_data <- NCA %>% filter(PARAM == "Cmax")
# AUC Men vs Women
boxplot_auc <- ggplot(auc_data, aes(x = SEX, y = VALUE_NORM, fill = SEX)) +
geom_boxplot() +
labs(title = "Dose-normalized AUC by Sex", y = "AUC_norm", x = "Sex") +
theme_minimal()
# Cmax Men vs Women
boxplot_cmax <- ggplot(cmax_data, aes(x = SEX, y = VALUE_NORM, fill = SEX)) +
geom_boxplot() +
labs(title = "Dose-normalized Cmax by Sex", y = "Cmax_norm", x = "Sex") +
theme_minimal()
# AUC vs bodyweight
scatter_auc <- ggplot(auc_data, aes(x = WEIGHTB, y = VALUE_NORM, color = SEX)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "AUC_norm vs Body Weight", x = "Body Weight", y = "AUC_norm") +
theme_minimal()
# Cmax vs bodyweigh
scatter_cmax <- ggplot(cmax_data, aes(x = WEIGHTB, y = VALUE_NORM)) +
geom_point() +
geom_smooth(method = "lm", se = FALSE) +
labs(title = "Cmax_norm vs Body Weight", x = "Body Weight", y = "Cmax_norm") +
theme_minimal()
combined_plot <- (boxplot_auc | boxplot_cmax) / (scatter_auc | scatter_cmax)
print(combined_plot)
print(combined_plot)
print(gg)
# Cmax Men vs Women
boxplot_cmax <- ggplot(cmax_data, aes(x = SEX, y = VALUE_NORM, fill = SEX)) +
geom_boxplot() +
labs(title = "Dose-normalized Cmax by Sex", y = "Cmax_norm", x = "Sex") +
theme_minimal()
pk_data <- pkpd_data %>%
filter(CMT==2)
ct_plot <- ggplot(data = pk_data,
aes(x = NOMTIME, y = LIDV,
group = TRTACT_high2low,
color = TRTACT_high2low))
head(pk_data)
View(pk_data)
library(nlme)
library(nlme)
# Nonlinear mixed effects model
pk_model <- nlme(
LIDV ~ Dose / (Vd * exp(-CL/Vd * TIME)),  # One-compartment model
data = pk_data,
fixed = list(CL + Vd ~ 1),                 # Fixed effects for CL and Vd
random = list(ID = pdDiag(CL + Vd ~ 1)),   # Random effects by individual (ID)
start = c(CL = 5, Vd = 50),                # Initial estimates for CL and Vd
control = list(msMaxIter = 100)
)
summary(pk_model)
View(pk_data)
# Nonlinear mixed effects model
pk_model <- nlme(
LIDV ~ DOSE / (Vd * exp(-CL/Vd * TIME)),  # One-compartment model
data = pk_data,
fixed = list(CL + Vd ~ 1),                 # Fixed effects for CL and Vd
random = list(ID = pdDiag(CL + Vd ~ 1)),   # Random effects by individual (ID)
start = c(CL = 5, Vd = 50),                # Initial estimates for CL and Vd
control = list(msMaxIter = 100)
)
summary(pk_model)
pk_model <- nlme(
LIDV ~ DOSE / (Vd * exp(-CL/Vd * TIME)),  # One-compartment model
data = pk_data,
fixed = list(CL + Vd ~ 1),                 # Fixed effects for CL and Vd
random = list(ID = pdDiag(CL + Vd ~ 1)),   # Random effects by individual (ID)
start = c(CL = 5, Vd = 50),                # Initial estimates for CL and Vd
control = list(msMaxIter = 100)
)
pk_data <- pk_data %>%
filter(!is.na(LIDV), !is.nan(LIDV))
# Nonlinear mixed effects model
pk_model <- nlme(
LIDV ~ DOSE / (Vd * exp(-CL/Vd * TIME)),  # One-compartment model
data = pk_data,
fixed = list(CL + Vd ~ 1),                 # Fixed effects for CL and Vd
random = list(ID = pdDiag(CL + Vd ~ 1)),   # Random effects by individual (ID)
start = c(CL = 5, Vd = 50),                # Initial estimates for CL and Vd
control = list(msMaxIter = 100)
)
summary(pk_model)
fixed_effects <- fixef(pk_model)
print(fixed_effects)
random_effects <- VarCorr(pk_model)
print(random_effects)
pk_model_cov <- update(pk_model, fixed = list(CL + Vd ~ WEIGHT + GENDER))
summary(pk_model_cov)
pk_model_cov <- update(pk_model, fixed = list(CL + Vd ~ WEIGHTB + SEX))
summary(pk_model_cov)
pk_model_cov <- update(pk_model, fixed = list(CL + Vd ~ WEIGHTB + SEX))
sum(is.na(pk_data$WEIGHTB))
sum(is.na(pk_data$SEX))
pk_data$SEX <- as.factor(pk_data$SEX)
# Nonlinear mixed effects model
pk_model <- nlme(
LIDV ~ DOSE / (Vd * exp(-CL/Vd * TIME)),  # One-compartment model
data = pk_data,
fixed = list(CL + Vd ~ 1),                 # Fixed effects for CL and Vd
random = list(ID = pdDiag(CL + Vd ~ 1)),   # Random effects by individual (ID)
start = c(CL = 5, Vd = 50),                # Initial estimates for CL and Vd
control = list(msMaxIter = 100)
)
summary(pk_model)
fixed_effects <- fixef(pk_model)
print(fixed_effects)
